# AI Engineering Summary Bot

An AI-powered CLI tool that generates daily (or on-demand) engineering digests from GitHub repository activity. It analyzes PRs, CI status, deployments, and generates human-readable summaries with risk assessments.

## Features

- **Smart PR Analysis**: Fetches and analyzes merged pull requests with metadata
- **Risk Assessment**: Two modes:
  - **Formula-based** (default): Fast, consistent scoring based on size, files, tests, and time
  - **AI-enhanced** (optional): Deep contextual analysis using GPT-5 for critical PRs
- **CI/CD Monitoring**: Tracks workflow runs, failures, and flaky tests
- **Deployment Tracking**: Monitors GitHub deployment events with PR associations
- **AI-Powered Summaries**: Uses OpenAI GPT-4 to generate actionable insights
- **File Output**: Save digests as markdown for sharing and archiving
- **Beautiful CLI Output**: Built with React-Ink for a modern terminal experience

## Tech Stack

- **Runtime**: Bun
- **AI**: Vercel AI SDK with OpenAI
- **GitHub API**: Octokit
- **CLI UI**: React-Ink
- **Language**: TypeScript

## Installation

1. Install dependencies:

```bash
bun install
```

2. Create a `.env` file from the template:

```bash
# Copy the template
cp env.template .env

# Then edit .env and add your actual tokens
```

3. Set up your tokens:
   - **GitHub Token**: Create a Personal Access Token at <https://github.com/settings/tokens> with `repo` access
   - **OpenAI API Key**: Get your API key from <https://platform.openai.com/api-keys>

## Usage

Generate a digest for any GitHub repository:

```bash
bun run src/index.tsx digest --owner=facebook --repo=react
```

### Options

- `--owner <owner>`: GitHub repository owner/organization (required)
- `--repo <repo>`: GitHub repository name (required)
- `--since <hours>`: Hours to look back (default: 24)
- `--output <path>`: Write digest to file in markdown format (optional)
- `--ai-risk`: Enable AI-powered risk scoring for more accurate analysis (optional)
- `--ai-risk-threshold <0-1>`: Formula risk threshold for AI analysis (default: 0.5)

### Examples

```bash
# Last 24 hours (default)
bun run src/index.tsx digest --owner=vercel --repo=next.js

# Last 48 hours
bun run src/index.tsx digest --owner=microsoft --repo=vscode --since=48

# Last week
bun run src/index.tsx digest --owner=facebook --repo=react --since=168

# Save digest to file
bun run src/index.tsx digest --owner=myorg --repo=myrepo --output=digest.md

# Weekly digest saved to file
bun run src/index.tsx digest --owner=myorg --repo=myrepo --since=168 --output=weekly-digest-$(date +%Y-%m-%d).md

# AI-enhanced risk scoring (analyzes high-risk PRs with GPT-4)
bun run src/index.tsx digest --owner=myorg --repo=myrepo --ai-risk --ai-risk-threshold=0.5

# Full AI analysis with file output
bun run src/index.tsx digest --owner=myorg --repo=myrepo --ai-risk --output=digest.md
```

> **Note**: See [AI-RISK-SCORING.md](./AI-RISK-SCORING.md) for detailed documentation on AI-powered risk analysis.

## Output

The digest is displayed in the terminal with beautiful formatting, and can optionally be saved to a markdown file.

### Terminal Output

The digest includes:

### ðŸ“ AI Summary

Concise highlights and insights generated by GPT-4

### ðŸ“Š Overview

- Total PRs merged
- Risky changes flagged
- CI failures
- Deployments

### ðŸ·ï¸ Merged PRs by Label

PRs grouped by labels (payments, settlements, etc.) with metadata:

- File changes
- Line additions/deletions
- Risk scores
- Direct links

### âš ï¸ Risky Changes

PRs flagged as higher risk with explanations:

- Large changes
- Many files touched
- No tests added
- Long merge times

### ðŸ”§ CI Status

Recent workflow runs and failures:

- Failed jobs and steps
- Flaky test detection
- Build health

### ðŸš€ Deployments

Recent deployment events:

- Environment
- Timestamp
- Associated PRs

### File Output

When using `--output`, the digest is saved as a markdown file with:

- Properly formatted headers and sections
- Clickable links to PRs, workflows, and commits
- Tables and lists for easy reading
- Perfect for:
  - Sharing with team via Slack/email
  - Archiving in documentation
  - Tracking project history
  - Creating weekly/monthly reports

## Risk Calculation

Risk score formula:

```typescript
risk = normalize(lines_changed) * 0.4
     + normalize(changed_files) * 0.3
     + (no_tests_added ? 0.2 : 0)
     + (time_to_merge_hours > 72 ? 0.1 : 0)
```

PRs with risk scores â‰¥50% are flagged as "risky".

## Project Structure

```md
ai-summary/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.tsx              # CLI entry point
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â””â”€â”€ digest.ts          # Main digest command
â”‚   â”œâ”€â”€ github/
â”‚   â”‚   â”œâ”€â”€ client.ts          # Octokit setup
â”‚   â”‚   â”œâ”€â”€ fetchers.ts        # API data fetchers
â”‚   â”‚   â””â”€â”€ types.ts           # TypeScript types
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â”œâ”€â”€ risk.ts            # Risk calculation
â”‚   â”‚   â””â”€â”€ grouping.ts        # PR grouping logic
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â””â”€â”€ summarizer.ts      # OpenAI integration
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â””â”€â”€ DigestView.tsx     # React-Ink components
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ index.ts           # Configuration management
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## Development

Run in development mode:

```bash
bun run dev digest --owner=myorg --repo=myrepo
```

## Future Enhancements

- **Slack Bot Integration**: Scheduled digests posted to Slack channels
- **Caching Layer**: Reduce API calls with local caching
- **Multiple Repos**: Single digest for multiple repositories
- **Webhook Mode**: Real-time updates via GitHub webhooks
- **Custom Thresholds**: Configurable risk assessment parameters
- **Export Formats**: JSON, Markdown, HTML output options

## Troubleshooting

### "GITHUB_TOKEN environment variable is required"

Make sure you've created a `.env` file with your GitHub token.

### "OPENAI_API_KEY environment variable is required"

Add your OpenAI API key to the `.env` file.

### Rate Limiting

GitHub API has rate limits. Authenticated requests get 5,000 requests/hour. For large repos with many PRs, consider increasing `--since` hours.

### No Deployments

Not all repositories use GitHub Deployments API. This section will be empty if your repo doesn't have deployment events.

## License

MIT

## Contributing

Contributions welcome! This is a starting point - feel free to extend with additional features.
